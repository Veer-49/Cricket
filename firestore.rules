rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow test writes for development (remove in production)
    match /_test/{docId} {
      allow read, write: if request.auth != null;
    }
    
    // Users can read/write their own documents
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null && request.auth.uid == userId;
    }
    
    // Authenticated users can read teams
    match /teams/{teamId} {
      allow read: if request.auth != null;
      allow write, create, update: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    // Authenticated users can read/write matches
    match /matches/{matchId} {
      allow read, write: if request.auth != null;
      allow create: if request.auth != null;
    }
    
    // Authenticated users can read/write player stats
    match /playerStats/{playerId} {
      allow read, write: if request.auth != null && request.auth.uid == playerId;
      allow create: if request.auth != null && request.auth.uid == playerId;
    }
    
    // Device tokens for notifications
    match /deviceTokens/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null && request.auth.uid == userId;
    }
    
    // Web push tokens (alternative path)
    match /webPushTokens/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null && request.auth.uid == userId;
    }
    
    // Notification queue
    match /notificationQueue/{notificationId} {
      allow read, write: if request.auth != null;
      allow create: if request.auth != null;
    }
    
    // Teams data (legacy support)
    match /teams/{teamId}/players/{playerId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // Match innings data
    match /matches/{matchId}/innings/{inningsId} {
      allow read, write: if request.auth != null;
      allow create: if request.auth != null;
    }
    
    // Match balls data
    match /matches/{matchId}/balls/{ballId} {
      allow read, write: if request.auth != null;
      allow create: if request.auth != null;
    }
  }
}
